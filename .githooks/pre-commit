#!/usr/bin/env bash
set -euo pipefail

staged_files="$(git diff --cached --name-only --diff-filter=ACMR)"

if [[ -z "${staged_files}" ]]; then
  exit 0
fi

if echo "${staged_files}" | grep -Eiq '(^|/)(\.env(\..*)?|.*\.pem|.*\.key)$'; then
  echo "❌ Commit blocked: potential secret file staged (.env/.pem/.key)."
  echo "Remove it from the commit and try again."
  exit 1
fi

echo "✅ Pre-commit secret guard passed."
